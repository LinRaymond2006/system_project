%INCLUDE "LDR_CFG.INC"
[BITS 16]
[ORG BUFFERBASE]
;DISK_PACKET: 0X500~0X700
;MEM_STRUCT: 0X700~0X900
%DEFINE MEM_STRUCT_BASE 0X500


DO_CLEAR_SCR:
	MOV	AX,	0600H
	MOV	BX,	0700H
	MOV	CX,	0
	MOV	DX,	0184FH
	INT	0X10



START_GET_MEM_STRUCT:
    XOR EBX, EBX
    MOV ES, BX      ;ES=0 (STRUCTURE ADDRESS: 0X0000:0X0700 )
    MOV DI, MEM_STRUCT_BASE

    .GET_MEM_STRUCT_LOOP:
        MOV EAX, DWORD 0XE820
        MOV ECX, DWORD 20
        MOV EDX, DWORD "SMAP"
        INT 0X15
        JC .GET_STRUCT_FAILED
        ADD DI, 20
        CMP EBX, 0
        JNE .GET_MEM_STRUCT_LOOP
        JMP .GET_MEM_STRUCT_DONE
    .GET_MEM_STRUCT_FAILED:
        ;AH=ERROR CODE (0X80:INVALID COMMAND;0X86 = "E820 NOT SUPPORTED" )
        JMP $       ;HALT FOR NOW, TAKE FURTHER ACTION IN FUTURE (PRINT LOG)
    .GET_MEM_STRUCT_DONE:
        
        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
        ;START HERE!!!
        



JMP $




[SECTION .SUBROUTINE]

%INCLUDE "LOADER_LIB.INC"