implement resource locking (spin locks maybe)